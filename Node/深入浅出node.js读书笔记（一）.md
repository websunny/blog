# 深入浅出Node.js读书笔记（一）

***

## 第一章Node简介

> 起初，Ryan Dahl􏲟称他的项目为web.js，就是一个Web服务􏰕器，但是项目的发展超过了他最初单纯开发一个Web服务器的想法，变成了构建网络应用的一个基础框架，这样可以在它的基础上构建更多的东西，诸如服务器、客户端、命令行工具等。

### Node的特点

#### 1.异步I/O

优于Ryan Dahl最初的目􏵥是写一个基于事件􏰊驱动、非阻塞􏰺􏺟􏺠I/O的Web服务􏰕，以􏸋达到更􏰢高的性能。使用异步I/O无可避免的事Node的一大特点。

```js
const fs = require('fs')
fs.readFile('./path',function(err,file){
  console.log("读取文件完成")
})
console.log("读取文件中")
```

这里我们知道读取文件中是在读取文件完成前输出的，而读取文件完成的执行取决于读取文件的异步调用是什么时候结束的。

异步有什么好处，举个简单的例子，你开车在回老家的路上（Node的js执行线程是单线程所以只有一条路），前方的车抛锚了，同步意味着你需要等待前面的车修好，才能继续上路，运气好等个三五分钟，运气不好那就是天荒地老，而异步的好处在于，前面的车会瞬间被拖车拖走带去去傍边的修理厂，你可以马上上路，节省了大量等待时间。

#### 2.回调函数

Node中回调函数也是一大特点，往往在node代码中充斥着回调函数。但是这种编程方式对于很多习惯同步思路编程的人来说，是非常不习惯的，代码的编写顺序和执行顺序无关，这对他们（我）可能造成了理解上的障碍，回调地狱（函数作为参数层层嵌套）绝大程度上就是不适应异步编程所造成的。

上述的异步调用其实就是采用了回调函数，当遇到异步调用时，会封装请求对象，设置参数和回调函数，然后将这个对象移出js主线程，将其放入线程池等待执行。按照上述例子讲就是，车子坏了之后被放入了修理厂，当车子修完后会调用回调函数，请求重新上路，路上空了之后就可以继续上路了。

#### 3.单线程

Node􏵨􏹖保持了JavaScript在浏览器􏴱􏴲􏰕中􏴶单线程的特点􏷄􏲀。􏰩且在Node中，JavaScript与其余线程时不能共􏲽􏷂享􏰣􏰤􏶦􏴷的。单线程的最大好处是不用像多线程编程那样处处在意状态的同步问题，这里并没有死锁的存在，也没有线程上下文交换带来的性能上的开销。

单线程当然也有弱点，这些弱点是学习Node中必须面对的，积极的面对这些弱点，可以使其得以高效利用。

* 无法利用多核cpu（Node只有一个事件循环机制）
* 错误会引起整个应用退出
* 大量的计算会占有cpu导致无法继续调用异步I/O

***

#### 小结

Node.js 具备了异步、非阻塞、事件驱动的能力。因此，NodeJS能响应大量的并发请求。所以，NodeJS适合运用在高并发、I/O密集、少量业务逻辑的场景。上面提到，如果是 I/O 任务，Node.js 就把任务交给线程池来异步处理，高效简单，因此 Node.js 适合处理I/O密集型任务。但不是所有的任务都是 I/O 密集型任务，当碰到CPU密集型任务时，即只用CPU计算的操作，比如要对数据加解密(node.bcrypt.js)，数据压缩和解压(node-tar)，这时 Node.js 就会亲自处理，一个一个的计算，前面的任务没有执行完，后面的任务就只能干等着 。



